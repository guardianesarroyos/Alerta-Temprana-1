<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alerta Temprana de Lluvias</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      position: relative;
    }

    .header {
      text-align: center;
      margin-bottom: 1rem;
    }

    .header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    .selector-container, .info-buttons, .slider-container, .checkboxes, .impact-container, .frase-ambiental-container, .footer {
      width: calc(100% - 80px);
      margin-top: 1rem;
    }

    .level-bar {
      position: fixed;
      right: 10px;
      top: 10%;
      height: 80vh;
      width: 60px;
      background-color: rgba(51, 51, 51, 0.6);
      border-radius: 10px;
      overflow: hidden;
      z-index: 10;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
    }

    .level-fill {
      width: 100%;
      background-color: #00bfff;
      transition: height 0.3s ease;
      position: absolute;
      bottom: 0;
      z-index: 1;
    }

    .marks {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      z-index: 2;
      pointer-events: none;
    }

    .mark {
      width: 100%;
      text-align: center;
      font-size: 0.7rem;
      border-top: 1px solid #aaa;
      height: calc(100% / 23);
      box-sizing: border-box;
      color: #fff;
      background: transparent;
    }

    .impact-container {
      padding: 1rem 1.2rem;
      border: 2px solid #00bfff;
      border-radius: 12px;
      background-color: rgba(0, 191, 255, 0.15);
      box-shadow: 0 0 8px #00bfff88;
      color: #a0eaff;
      font-weight: 700;
      font-size: 1.2rem;
      text-shadow: 0 0 6px #00bfffaa;
      user-select: none;
    }

    .frase-ambiental-container {
      padding: 8px 12px;
      text-align: center;
      font-style: italic;
      color: #FF6D00;
      background-color: rgba(255, 109, 0, 0.08);
      border-radius: 6px;
      font-size: 0.85em;
      border-left: 3px solid rgba(255, 109, 0, 0.3);
      opacity: 0.9;
    }

    /* Estilos para los modales */
    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 1.5rem;
      border-radius: 10px;
      z-index: 100;
      width: 90%;
      max-width: 300px;
      text-align: center;
      border: 1px solid #FF6D00;
    }

    .modal h3 {
      color: #FF6D00;
      margin-top: 0;
    }

    .modal input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border-radius: 4px;
      border: none;
    }

    .modal-buttons {
      margin-top: 15px;
    }

    .btn-primary {
      background: #FF6D00;
      color: #000;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      font-weight: bold;
      margin-right: 10px;
      cursor: pointer;
    }

    .btn-secondary {
      background: transparent;
      color: #FF6D00;
      border: 1px solid #FF6D00;
      padding: 7px 14px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Alerta Temprana</h1>
    <h1>Arroyo Escobar</h1>
  </div>

  <div class="selector-container">
    <label for="scenario">Escenario:</label>
    <select id="scenario">
      <option value="24">24 hs</option>
      <option value="48">48 hs</option>
      <option value="72">72 hs</option>
    </select>
  </div>

  <div class="info-buttons">
    <button onclick="alert('El escenario de 24 hs simula lluvias concentradas.')">+ info 24h</button>
    <button onclick="alert('El escenario de 48 hs contempla lluvias repartidas.')">+ info 48h</button>
    <button onclick="alert('El escenario de 72 hs modela lluvias prolongadas.')">+ info 72h</button>
  </div>

  <div class="slider-container">
    <label for="rain">Lluvia acumulada (mm): <span id="rainValue">0</span></label>
    <input type="range" id="rain" min="0" max="300" step="10" value="0" />
  </div>

  <div class="checkboxes">
    <label><input type="checkbox" id="sudestada" /> Sudestada</label><br />
    <label><input type="checkbox" id="aguasArriba" /> Lluvias aguas arriba</label><br />
    <label><input type="checkbox" id="sueloSaturado" /> Suelos saturados</label>
  </div>

  <div class="impact-container">
    <p>Altura estimada: <span id="altura"></span> m</p>
    <p>Impacto estimado: <span id="impacto"></span></p>
  </div>

  <div style="margin-top: 1rem;">
    <button id="btnMiCasa" onclick="mostrarModalCasa()" style="background-color:#FF6D00; color:#000; border:none; border-radius:6px; padding:0.4rem 1rem; cursor:pointer; font-weight:bold;">
      + Mi casa
    </button>
  </div>

  <div class="frase-ambiental-container" id="fraseAmbiental"></div>

  <!-- Modal para altura de casa -->
  <div id="modalCasa" class="modal">
    <h3>Altura de mi casa</h3>
    <p>Ingresá la altura sobre el nivel del arroyo (en metros):</p>
    <input type="number" id="alturaCasaInput" step="0.01" min="0" max="6" placeholder="Ej: 2.50" />
    <div class="modal-buttons">
      <button onclick="guardarAlturaCasa()" class="btn-primary">Guardar</button>
      <button onclick="document.getElementById('modalCasa').style.display='none'" class="btn-secondary">Cancelar</button>
    </div>
  </div>

  <!-- Modal para registro -->
  <div id="modalRegistro" class="modal">
    <h3>Registro opcional</h3>
    <p>Ingresá tu email para guardar la altura de tu casa:</p>
    <input type="email" id="emailInput" placeholder="tu@email.com" />
    <div class="modal-buttons">
      <button onclick="registrarUsuario()" class="btn-primary">Registrar</button>
      <button onclick="document.getElementById('modalRegistro').style.display='none'" class="btn-secondary">Cancelar</button>
    </div>
    <p style="font-size:0.7em; margin-bottom:0;">Solo te contactaremos para mejoras del servicio</p>
  </div>

  <div class="level-bar">
    <div class="level-fill" id="levelFill"></div>
    <div class="marks" id="marks"></div>
  </div>

  <div class="footer">
    Creado por guardianesarroyosba © vecinos autoconvocados
  </div>

  <script>
    // Elementos del DOM
    const rain = document.getElementById("rain");
    const rainValue = document.getElementById("rainValue");
    const alturaDisplay = document.getElementById("altura");
    const impactoDisplay = document.getElementById("impacto");
    const scenario = document.getElementById("scenario");
    const sudestada = document.getElementById("sudestada");
    const aguasArriba = document.getElementById("aguasArriba");
    const sueloSaturado = document.getElementById("sueloSaturado");
    const levelFill = document.getElementById("levelFill");
    const marks = document.getElementById("marks");

    // Tabla de referencia para cálculos
    const tabla = {
      0: [1.3, 1.16, 1.05],
      100: [3.47, 3.09, 2.81],
      200: [4.8, 4.27, 3.89],
      300: [5.8, 5.16, 4.7]
    };

    // Función principal de cálculo
    function updateValues() {
      const mm = parseInt(rain.value);
      let mmEfectivos = mm;
      if (sueloSaturado.checked) mmEfectivos = Math.min(mm * 2, 300);
      const fila = tabla[mmEfectivos] || tabla[0];
      let altura = fila[parseInt(scenario.value) / 24 - 1] || 0;
      if (sudestada.checked) altura += 0.2;
      if (aguasArriba.checked) altura += 0.2;
      altura = Math.min(altura, 5.8);
      alturaDisplay.textContent = altura.toFixed(2);

      let impacto = "Sin impacto";
      if (altura >= 3.6 && altura < 4.1) impacto = "Desborde: terrenos bajos, calles y casas";
      else if (altura >= 4.1 && altura < 4.5) impacto = "Ingreso en casas bajas y medias";
      else if (altura >= 4.5 && altura < 5.2) impacto = "Inundación de casas medias y altas";
      else if (altura >= 5.2) impacto = "Corte de ruta, inundación severa";

      impactoDisplay.textContent = impacto;
      levelFill.style.height = `${(altura / 5.8) * 100}%`;
      
      // Verificar si el agua supera la altura de la casa
      verificarAlertaPersonalizada(altura);
    }

    // Marcas en la barra de nivel
    for (let i = 5.8; i >= 0; i -= 0.25) {
      const mark = document.createElement("div");
      mark.classList.add("mark");
      mark.textContent = i.toFixed(2);
      marks.appendChild(mark);
    }

    // Frase ambiental del día
    function mostrarFraseDelDia() {
      const frases = [
        "No es la lluvia, es la falta de obras.",
        "No nos inunda el clima, nos inunda la inacción.",
        "El agua cae del cielo, pero los daños vienen de abajo."
      ];
      const hoy = new Date(), inicio = new Date(2023, 0, 1);
      const i = Math.floor((hoy - inicio) / (1000 * 60 * 60 * 24)) % frases.length;
      document.getElementById('fraseAmbiental').textContent = frases[i];
    }

    // Sistema de registro
    function registrarUsuario() {
      const email = document.getElementById('emailInput').value;
      
      if (!email.includes('@') || !email.includes('.')) {
        alert("Por favor ingresá un email válido");
        return;
      }

      // Guardar localmente
      localStorage.setItem('userEmail', email);
      localStorage.setItem('usuarioRegistrado', 'true');
      
      // Guardar en archivo (simulación)
      guardarEmailEnTxt(email);
      
      alert("¡Registro exitoso! Ahora podés guardar la altura de tu casa.");
      document.getElementById('modalRegistro').style.display = 'none';
    }

    // Simulación de guardado en TXT
    function guardarEmailEnTxt(email) {
      console.log("Email guardado (simulación):", email);
      // En producción, aquí iría la llamada a tu backend o servicio
    }

    // Altura de la casa
    function mostrarModalCasa() {
      if (localStorage.getItem('usuarioRegistrado') !== 'true') {
        document.getElementById('modalRegistro').style.display = 'block';
        return;
      }
      document.getElementById('modalCasa').style.display = 'block';
    }

    function guardarAlturaCasa() {
      const valor = parseFloat(document.getElementById('alturaCasaInput').value);
      if (!isNaN(valor)) {
        localStorage.setItem('miAlturaCasa', valor.toFixed(2));
        document.getElementById('modalCasa').style.display = 'none';
        dibujarMarcaCasa();
      }
    }

    function dibujarMarcaCasa() {
      const alturaCasa = parseFloat(localStorage.getItem('miAlturaCasa'));
      if (!isNaN(alturaCasa)) {
        let marca = document.getElementById('marcaCasa');
        if (marca) marca.remove();
        
        const barra = document.querySelector('.level-bar');
        marca = document.createElement('div');
        marca.id = 'marcaCasa';
        marca.style.position = 'absolute';
        marca.style.left = '0';
        marca.style.width = '100%';
        marca.style.height = '2px';
        marca.style.background = 'orange';
        marca.style.bottom = `${(alturaCasa / 5.8) * 100}%`;
        marca.style.zIndex = 3;
        barra.appendChild(marca);
      }
    }

    // Verificar alerta personalizada
    function verificarAlertaPersonalizada(alturaArroyo) {
      const alturaCasa = parseFloat(localStorage.getItem('miAlturaCasa'));
      if (!isNaN(alturaCasa) && alturaArroyo >= alturaCasa) {
        impactoDisplay.innerHTML += `<br><span style="color:#FF6D00">¡ALERTA! El agua alcanzaría tu casa</span>`;
      }
    }

    // Event listeners
    rain.addEventListener("input", () => {
      rainValue.textContent = rain.value;
      updateValues();
    });

    scenario.addEventListener("change", updateValues);
    sudestada.addEventListener("change", updateValues);
    aguasArriba.addEventListener("change", updateValues);
    sueloSaturado.addEventListener("change", updateValues);

    // Inicialización
    updateValues();
    mostrarFraseDelDia();

    // Verificar si ya está registrado
    if (localStorage.getItem('usuarioRegistrado') === 'true') {
      dibujarMarcaCasa();
    }
  </script>
</body>
</html>